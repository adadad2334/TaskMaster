# TaskMaster - умный таск-трекер с оптимальным распределением задач

TaskMaster - это API для управления проектами и задачами с функцией интеллектуального распределения задач между исполнителями на основе их навыков, текущей загруженности и приоритетов задач.

## Основные особенности

- Регистрация и аутентификация пользователей с JWT-токенами
- Управление проектами и участниками проектов
- Управление задачами с различными статусами и приоритетами
- Система навыков для пользователей и задач
- Автоматическое назначение задач исполнителям с использованием алгоритма оптимизации
- Полное REST API с документацией Swagger

## Технологии

- FastAPI - современный, быстрый веб-фреймворк для создания API
- SQLAlchemy - ORM для работы с базой данных
- Pydantic - валидация данных и сериализация
- JWT - безопасная аутентификация и авторизация
- SQLite - легковесная база данных (можно заменить на PostgreSQL)
- Pytest - тестирование API

## Требования к окружению

- Python 3.11 или 3.13+ (для Python 3.13+ необходима установка последних версий библиотек)
- pip (менеджер пакетов Python)
- virtualenv (для создания изолированного окружения)

> **Примечание**: В файле requirements.txt указаны минимальные версии библиотек, совместимые с Python 3.13+.
> Если используете Python 3.11, возможно, потребуется откатить версии библиотек на более старые.

## Модель базы данных

В проекте используется реляционная база данных со следующими основными сущностями:

1. **User** - пользователи системы
2. **Project** - проекты, объединяющие задачи и исполнителей
3. **Task** - задачи с приоритетами, статусами и оценками трудозатрат
4. **Skill** - навыки, которыми обладают пользователи и которые требуются для выполнения задач

## Алгоритм автоматического назначения задач

Основная особенность TaskMaster - интеллектуальный алгоритм распределения задач, основанный на:

1. **Венгерском алгоритме** - алгоритм для решения задачи о назначениях в теории оптимизации
2. **Матрице стоимости** - матрица, определяющая "стоимость" назначения задачи конкретному исполнителю

При распределении учитываются следующие факторы:
- Совпадение навыков исполнителя и требований задачи
- Текущая загруженность исполнителя
- Приоритет задачи
- Срок выполнения задачи

Алгоритм может работать в нескольких режимах оптимизации:
- **balanced** - сбалансированное распределение (по умолчанию)
- **workload** - приоритет равномерной загрузки
- **skills** - приоритет соответствия навыков
- **priority** - приоритет важности задач

## Установка и запуск

### Быстрая установка (автоматическая)

Для автоматической настройки среды и установки всех зависимостей запустите скрипт:

```
python setup_env.py
```

Этот скрипт:
- Создает виртуальную среду
- Устанавливает все необходимые зависимости
- Обновляет библиотеки, если у вас Python 3.13+
- Создает файл .env и базу данных
- Инициализирует таблицы в базе данных

После успешного выполнения скрипта вы можете активировать среду и запустить приложение.

### Ручная установка (Windows)

1. Клонируйте репозиторий:
```
git clone https://github.com/your-username/taskmaster.git
cd taskmaster
```

2. Создайте и активируйте виртуальное окружение:
```
python -m venv taskmaster_env
.\taskmaster_env\Scripts\activate
```

3. Установите зависимости:
```
pip install -r requirements.txt
```

4. Если вы используете Python 3.13+ и видите ошибки совместимости библиотек, обновите их до последних версий:
```
pip install fastapi>=0.104.1 uvicorn>=0.24.0 sqlalchemy>=2.0.27 pydantic>=2.4.0
```

5. Создайте файл `.env` в корневой директории с настройками:
```
DATABASE_URL=sqlite:///./taskmaster.db
SECRET_KEY=ваш_секретный_ключ_здесь
```

### Запуск

1. Убедитесь, что виртуальное окружение активировано:
```
.\taskmaster_env\Scripts\activate  # для Windows
```

2. Запустите сервер:
```
uvicorn app.main:app --reload
```

3. Откройте Swagger UI для работы с API:
```
http://localhost:8000/docs
```

## Тестирование

Запустите тесты с помощью pytest:
```
python run_tests.py
```

Этот скрипт:
- Запускает все тесты с генерацией отчета о покрытии
- Проверяет, что покрытие составляет не менее 70%
- Запускает pylint для анализа кода
- Сохраняет отчет pylint в файл pylint.txt

## API Endpoints

### Аутентификация
- `POST /users/register` - Регистрация нового пользователя
- `POST /users/token` - Получение токена доступа

### Пользователи
- `GET /users/me` - Информация о текущем пользователе
- `GET /users/` - Список всех пользователей
- `GET /users/{user_id}` - Информация о конкретном пользователе
- `PUT /users/{user_id}` - Обновление информации о пользователе
- `DELETE /users/{user_id}` - Удаление пользователя
- `POST /users/{user_id}/skills/{skill_id}` - Добавление навыка пользователю
- `DELETE /users/{user_id}/skills/{skill_id}` - Удаление навыка у пользователя

### Проекты
- `POST /projects/` - Создание нового проекта
- `GET /projects/` - Список всех проектов
- `GET /projects/{project_id}` - Информация о конкретном проекте
- `PUT /projects/{project_id}` - Обновление информации о проекте
- `DELETE /projects/{project_id}` - Удаление проекта
- `POST /projects/{project_id}/members/{user_id}` - Добавление участника в проект
- `DELETE /projects/{project_id}/members/{user_id}` - Удаление участника из проекта

### Задачи
- `POST /tasks/` - Создание новой задачи
- `GET /tasks/` - Список всех задач
- `GET /tasks/my` - Список задач, назначенных на текущего пользователя
- `GET /tasks/{task_id}` - Информация о конкретной задаче
- `PUT /tasks/{task_id}` - Обновление информации о задаче
- `DELETE /tasks/{task_id}` - Удаление задачи

### Навыки
- `POST /skills/` - Создание нового навыка
- `GET /skills/` - Список всех навыков
- `GET /skills/{skill_id}` - Информация о конкретном навыке
- `DELETE /skills/{skill_id}` - Удаление навыка

### Автоматическое назначение
- `POST /assign/tasks/{project_id}` - Автоматическое назначение задач исполнителям в рамках проекта

## Запуск в Docker

Для запуска приложения в Docker:

1. Соберите образ:
```
docker build -t taskmaster .
```

2. Или используйте docker-compose:
```
docker-compose up -d
```

## Решение проблем

### Проблема с версиями Python и библиотеками
Если вы видите ошибку `TypeError: ForwardRef._evaluate() missing 1 required keyword-only argument: 'recursive_guard'`, это означает, что вы используете Python 3.13+ с устаревшими библиотеками. Обновите библиотеки до версий, указанных в requirements.txt, или даже до более новых версий.

### Проблема с созданием таблиц в базе данных
Если таблицы не создаются автоматически, вы можете создать их вручную, выполнив следующий код Python:
```python
from app.database import engine, Base
Base.metadata.create_all(bind=engine)
```

## Контакты

При возникновении вопросов или проблем, пожалуйста, создайте Issue в репозитории проекта. 